<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script type="text/javascript" src="./dest/ingoose.js"></script>
    <script type="text/javascript">
        // {{{ prepare
        var _v = 0;
        location.search.replace(/^\?/,'').split('&').forEach(function(pair){
            var k_v = pair.split('=');
            if (!k_v || k_v.length < 2) return;
            if (k_v[0] == 'v') _v = parseInt(k_v[1]);
        });
        var d = new Date();
        var db_name = 'ingoose_test' + d.toLocaleDateString();
        indexedDB.webkitGetDatabaseNames().onsuccess = function(ev, arg) {
            for (var i = 0; i < ev.target.result.length; i++) {
                var name = ev.target.result[i];
                if (name == db_name) continue;
                indexedDB.deleteDatabase(name);
            }
        };
        // }}}
        ingoose.connect(db_name, d.getHours() + _v).schemas({
            'user': {
                keyPath: 'age'
            },
            'todo': {
                keyPath: 'timestamp'
            }
        }).error(function(err) {
            window.alert("connect error!\n" + err.toString());
        }).success(function(res) {
            var User = ingoose.model('user');
            var user = new User({
                name: 'おちあい',
                age: 28
            });
            // user.age = 28;
            user.save().error(function(err) {
                window.alert("user.save error!\n" + err.toString());
            });
        });
    </script>
</head>
<body>
</body>
</html>
